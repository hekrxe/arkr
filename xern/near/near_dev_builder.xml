<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="deploy" name="near">
    <property name="project.name" value="near"/>
    <property name="dist.dir" value="target"/>
    <property name="compress.dir" value="../../generated"/>

    <target name="clean">
        <delete dir="${dist.dir}"/>
        <delete dir="${compress.dir}"/>
    </target>

    <target name="package" depends="clean">
        <exec dir="../.." executable="mvn.cmd" failonerror="true">
            <arg line="-T 1.5C package -Dmaven.test.skip=true -Pdev -pl xern/${project.name} -am"/>
        </exec>
    </target>

    <target name="compress-app">
        <mkdir dir="${compress.dir}"/>
        <move todir="${compress.dir}/classes" preservelastmodified="true">
            <fileset dir="${dist.dir}/classes"/>
        </move>

        <move todir="${compress.dir}/lib" preservelastmodified="true">
            <fileset dir="${dist.dir}/lib"/>
        </move>

        <move todir="${compress.dir}" preservelastmodified="true">
            <fileset dir="${dist.dir}" includes="*.jar"/>
        </move>

        <move todir="${compress.dir}/${project.name}" preservelastmodified="true">
            <fileset dir="${compress.dir}"/>
        </move>

        <zip destfile="${compress.dir}/${project.name}.zip">
            <zipfileset dir="${compress.dir}"/>
        </zip>

        <delete dir="${compress.dir}/${project.name}"/>
        <delete dir="${dist.dir}"/>
    </target>

    <target name="deploy">
        <echo message="begin auto packaging......"/>
        <antcall target="package"/>
        <antcall target="compress-app"/>
        <echo message="done"/>
    </target>

</project>
